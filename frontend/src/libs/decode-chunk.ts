import { Chunk, Pixel, PixelChange } from "../types"
import { palette } from "./colors"

const nullColors: Pixel[] = [
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
  { color: { r: 255, g: 255, b: 255 } },
]

const chunkToColors = (chunk: Chunk): Pixel[] => {
  if (!chunk) return nullColors
  const pixels: Pixel[] = []
  for (let i = 0; i < chunk.chunkdata.length; i++) {
    const color = palette[chunk.chunkdata[i]]
    const lByte = Math.floor(i / 8)
    const lOffset = i % 8
    const locked = (chunk.locks[lByte] & (1 << (7 - lOffset))) !== 0
    pixels.push({ color, locked })
  }
  return pixels
}

export default chunkToColors
